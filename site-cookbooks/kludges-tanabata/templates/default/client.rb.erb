cache_path "/var/chef/"
chef_repo_path "/var/chef-zero"

chef_zero.enabled true
local_mode true

log_location "/var/log/chef/zero.log"
verbose_logging true

recipe_url "<%= node["chef-solo"]["solourl"] %>/<%= node["chef-solo"]["tarball"] %>"
recipe_path "/var/chef-zero/recipes.tgz"

#client_key "/etc/chef/client.pem"

# FIXME:
# * Add repo dir cleanup
# * Use what we have if remote url is unavailable

File.open(recipe_path, 'wb') do |f|
  open(recipe_url) do |r|
    f.write(r.read)
  end
end
Chef::Mixin::Command.run_command(:command => "tar zxvf #{recipe_path} -C #{chef_repo_path}")
